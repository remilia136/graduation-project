<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style>
        .head {
            height: 65px;
            width: 100%;
            margin: 0;
            padding: 0;
            background-color: white;
            display: flex;
            position: fixed;
            z-index: 9999;
        }

        .body {
            /* padding-top: 100px; */
            display: flex;
            background-color: #006666;
            flex-direction: column;
        }

        .bg {
            width: 23%;
        }

        .top {
            height: 0px;
        }

        .mid {
            padding-top: 100px;
            display: flex;
            padding-bottom: 150px;
            background-image: url("./resource/wallhaven-9mjoy1.png");
        }

        body {
            background-color: #006666;
            margin: 0;
            padding: 0;

        }

        .title {
            opacity: 0.6;
            font-family: "STSong";
            position: relative;
            font-size: 18px;
            padding-right: 15px;
            padding-left: 15px;
        }

        div.title:hover {
            background-color: rgb(211, 223, 234);
        }

        .bottom {
            background-color: white;
            height: 100px;
            width: 100%;
            padding-top: 30px;
        }

        .url {
            padding-top: 50px;
        }
    </style>
</head>

<body>
    <div class="main">
        <div class="head">
            <div style="width: 50%;">
                <img src="./resource/logo.png">
            </div>
            <div style="display: flex;">
                <div class="title">
                    <p>我要直播</p>
                </div>
                <div class="title">
                    <p>观看直播</p>
                </div>
                <div class="title">
                    <p onclick="top_button3onclick()">@kuuhaku</p>
                </div>
            </div>

        </div>
        <div class="body">
            <div class="top"></div>
            <div class="mid">
                <div class=" bg"></div>
                <div class="mid-mid"
                    style="border-radius:5px;padding: 50px 50px 50px 50px;background-color:rgba(255,255,255,0.75);width: 120%;">
                    <div id="dplayer"></div>
                    <div class="url">
                        <div style="text-align: center;"><span
                                style="opacity: 0.6;font-family: 'STSong';">直播url</span><input type="url"
                                style="width: 70%;height: 25px;border: 1px solid;margin-left: 20px;" id="url"><button
                                id="bofang" style="height: 31px;margin-left: 50px;"
                                onclick="ButtonOnClick()">播放</button></div>
                    </div>
                </div>
                <div class="bg"></div>
            </div>
            <div class="bottom">
                <p style="padding-left: 200px;opacity: 0.6;font-family: 'STSong';font-size: 15px;">@kuuhaku
                    1465598548@qq.com</p>
                <p style="padding-left: 200px;opacity: 0.6;font-family: 'STSong';font-size: 15px;">
                    本站全部内容系大学生毕业设计，这部分是写着玩的，显得更像个网站，没有版权限制</p>
            </div>
        </div>

    </div>

    <script src="./js/DPlayer.min.js"></script>
    <script src="./js/flv.min.js"></script>
    <script>//播放器配置
        const dp = new DPlayer({
            container: document.getElementById('dplayer'),
            loop: true,
            autoplay: true,
            live: true,
            video: {
                //url: './resource/Lycoris.mp4',
                url: "http://45.77.253.113:8080/live/nihao.flv",
                type: 'flv',
                autoplay: true
            },
            apiBackend: {
                read: function (options) {
                    console.log('Pretend to connect WebSocket');
                    options.success([]);
                },
                send: function (options) {
                    console.log('Pretend to send danmaku via WebSocket', options.data);
                    options.success();
                },
            },
            danmaku: {
                //token: 'tokendemo',
                maximum: 1000,
                //addition: ['https://api.prprpr.me/dplayer/v3/bilibili?aid=4157142'],
                user: 'DIYgod',
                bottom: '15%',
                unlimited: true,
                speedRate: 0.5,

            },
        });
        setTimeout(function () {
            console.log("5second")
            dp.danmaku.draw({
                text: 'Get a danmaku via WebSocket',
                color: '#fff',
                type: 'right',
            })
        }, 5000)
        // dp.on('danmaku_send', function (send) {
        //     console.log(send);
        // });
        // 浏览器提供 WebSocket 对象
        const ws = new WebSocket('ws://45.77.255.151:3000');
        console.log(ws)
        dp.on("danmaku_send", function (message) {
            console.log(JSON.stringify(message))
            ws.send(JSON.stringify(message));
        })
        // 接收
        ws.onmessage = function (mes) {
            console.log(JSON.parse(mes.data))
            let message = JSON.parse(mes.data);
            dp.danmaku.draw({
                text: message.text,
                color: message.color,
                type: message.type,
            })
            //console.log(mes.data);
            //let data=JSON.parse(mes)
            //console.log(data.text);
            if (mes.data === 'hello') {
                ws.close();
            }
        }
    </script>
    <script>//按钮
        function top_button3onclick(){ 
            //window.scrollTo(0, document.documentElement.scrollHeight)
            let target = document.querySelector(".bottom")
            console.log(target)
            target.scrollIntoView({ behavior: 'smooth' });
        }
        function ButtonOnClick() {
            let url = document.getElementById("url").value;
            console.log(url);
            console.log(dp.video.src);
            dp.video.src = url;
        }

    </script>

</body>

</html>